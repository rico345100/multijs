window.Multi=new function(){var URL=window.URL||window.webkitURL,Blob=window.Blob,BlobUrl=!1,supportWorker=!1;"undefined"!=typeof window.Worker&&(supportWorker=!0),URL&&Blob||(supportWorker=!1);var threadNumber=0,states={wait:"wait",work:"work",complete:"complete",error:"error"};this.isSupportWorker=function(){return supportWorker},this.Thread=function(t){this._threadFunc=t,this._evalCode=!1,this._id=threadNumber++,this._state=states.wait,this._worker=null},this.Thread.prototype.getId=function(){return this._id},this.Thread.prototype.getState=function(){return this._state},this.Thread.prototype.execute=function(data,callback){if(!this._worker)throw new Error("Thread is not activated.");data=data||void 0;var self=this;return this._state=states.work,supportWorker?(this._worker.postMessage(data),this._worker.onmessage=function(t){self._state=states.complete,callback(null,t.data)},this._worker.onerror=function(t){self._state=states.error,callback(t,null)}):eval("var postData = "+data+";"+this._evalCode),this},this.Thread.prototype.start=function(){if(this._worker)throw new Error("Thread already started.");var t=this._threadFunc.toString();t=t.slice(t.indexOf("{")+1,t.lastIndexOf("}"));var e=t.match(/return(\s*)(.*);/,"postMessage ");if(!e||"undefined"==typeof e[1])throw new Error("Thread requires return statement.");if(new RegExp(/\/\/(\s*)return/).test(t))throw new Error("Thread requires return statement.");if(new RegExp(/\/\*(\s*)return/).test(t))throw new Error("Thread requires return statement.");var r=t.match(/return(.*)(\s*);/)[1];if(supportWorker){t=t.replace(/return(\s*)(.*);/,"postMessage(")+r+");",t="self.addEventListener('message', function(message) { var postData = message.data;"+t+" });";var a=new Blob([t]);BlobUrl=URL.createObjectURL(a),this._worker=new Worker(BlobUrl)}else{var s="var threadResultData = 0; setTimeout(function() { ",o=t.replace(/return(.*)(\s*);/,"");o=o.replace(/return(.*)(\s*);/,""),s+=o,s+="threadResultData = "+r+";",s+="callback(null, threadResultData);",s+="}, 10);",this._evalCode=s,this._worker=!0}return this},this.Thread.prototype.terminate=function(){if(!this._worker)throw new Error("Thread is not activated");return supportWorker&&(this._worker.terminate(),this._worker=URL.revokeObjectURL(BlobUrl)),this._worker=null,this._evalCode=!1,this}};