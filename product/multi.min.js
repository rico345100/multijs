window.Multi=new function(){var STATE={WAIT:0,PENDING:1,COMPLETED:2,ERROR:3},threadNumber=0,URL=window.URL||window.webkitURL,Blob=window.Blob,BlobUrl=!1,supportWorker=!1;"undefined"!=typeof window.Worker&&(supportWorker=!0),URL&&Blob||(supportWorker=!1),this.isSupportWorker=function(){return supportWorker},this.Thread=function(r){this.id=threadNumber++,this.state=STATE.WAIT,this._threadFunc=r,this._evalCode=!1,this._worker=null},this.Thread.prototype.execute=function(data,callback){if(!this._worker)throw new Error("Thread is not activated.");data=data||void 0;var self=this;return this.state=STATE.PENDING,supportWorker?(this._worker.postMessage(data),this._worker.onmessage=function(r){self.state=STATE.COMPLETED,callback(null,r.data)},this._worker.onerror=function(r){self.state=STATE.ERROR,callback(r,null)}):eval("var postData = "+data+";"+this._evalCode),this},this.Thread.prototype.start=function(){if(this._worker)throw new Error("Thread already started.");var r=this._threadFunc.toString();r=r.slice(r.indexOf("{")+1,r.lastIndexOf("}"));var e=r.match(/return(\s*)(.*);/,"postMessage ");if(!e||"undefined"==typeof e[1])throw new Error("Thread requires return statement.");if(/\/\/(\s*)return/.test(r)||/\/\*(\s*)return/.test(r))throw new Error("Thread requires return statement.");var t=r.match(/return(.*)(\s*);/)[1];if(supportWorker){r=r.replace(/return(\s*)(.*);/,"postMessage(")+t+");",r="self.addEventListener('message', function(message) { var postData = message.data;"+r+" });";var a=new Blob([r]);BlobUrl=URL.createObjectURL(a),this._worker=new Worker(BlobUrl),this._worker.postMessage(100)}else{var s="var threadResultData = 0; setTimeout(function() { ",o=r.replace(/return(.*)(\s*);/,"");s+=o,s+="threadResultData = "+t+";",s+="callback(null, threadResultData);",s+="}, 10);",this._evalCode=s,this._worker=!0}return this},this.Thread.prototype.terminate=function(){if(!this._worker)throw new Error("Thread is not activated");return supportWorker&&(this._worker.terminate(),this._worker=URL.revokeObjectURL(BlobUrl)),this._worker=null,this._evalCode=!1,this}};